{"version":3,"file":"octane-connect.js","sources":["../src/octane-connect.js"],"sourcesContent":["import { notifyPropertyChange, get, defineProperty } from '@ember/object';\nimport { inject } from '@ember/service';\nimport { bindActionCreators } from 'redux';\nimport { assert } from '@ember/debug';\n\nfunction changedKeys(props, newProps) {\n  return Object.keys(props).filter(key => {\n    return props[key] !== newProps[key];\n  });\n}\n\nfunction wrapStateToComputed(stateToComputed) {\n  return function(...args) {\n    const result = stateToComputed.call(this, ...args);\n    if (typeof result === 'function') {\n      return result.call(this, ...args);\n    }\n    return result;\n  };\n}\n\n\nfunction createProperty(getProps, name) {\n  let descriptor = {\n    enumerable: true,\n    configurable: false,\n    set() {\n      assert(`Cannot set redux property \"${name}\". Try dispatching a redux action instead.`);\n    },\n    get() {\n      return getProps()[name];\n    }\n  };\n  Object.defineProperty(this, name, descriptor);\n}\n\nexport default function octaneConnect(stateToComputed, dispatchToActions, WrappedComponent) {\n\n  defineProperty(WrappedComponent.prototype, 'redux', inject('redux'));\n\n  return class Connect extends WrappedComponent {\n\n    constructor() {\n      super(...arguments);\n      const redux = get(this, 'redux');\n\n      if (stateToComputed) {\n        const wrappedStateToComputed = wrapStateToComputed(stateToComputed);\n\n        const getProps = () => wrappedStateToComputed.call(this, redux.getState(), this.args);\n\n        let props = getProps();\n\n        Object.keys(props).forEach(name => {\n          createProperty.call(this, getProps, name);\n        });\n\n        this._handleChange = () => {\n          let newProps = getProps();\n\n          if (props === newProps) return;\n\n          let notifyProperties = changedKeys(props, newProps);\n\n          props = newProps;\n          notifyProperties.forEach(name => notifyPropertyChange(this, name));\n        };\n\n        this.unsubscribe = redux.subscribe(() => {\n          this._handleChange();\n        });\n      }\n      if (typeof dispatchToActions === 'function') {\n        this.actions = Object.assign({},\n          this.actions, dispatchToActions.call(this, redux.dispatch.bind(redux))\n        );\n      }\n\n      if (typeof dispatchToActions === 'object') {\n        this.actions = Object.assign({},\n          this.actions, bindActionCreators(dispatchToActions, redux.dispatch.bind(redux))\n        );\n      }\n    }\n\n    willDestroy() {\n      if (this.unsubscribe) {\n        this.unsubscribe();\n        this.unsubscribe = null;\n      }\n    }\n  }\n}\n"],"names":["changedKeys","props","newProps","Object","keys","filter","key","wrapStateToComputed","stateToComputed","args","result","call","createProperty","getProps","name","descriptor","enumerable","configurable","set","assert","get","defineProperty","octaneConnect","dispatchToActions","WrappedComponent","prototype","inject","Connect","constructor","arguments","redux","wrappedStateToComputed","getState","forEach","_handleChange","notifyProperties","notifyPropertyChange","unsubscribe","subscribe","actions","assign","dispatch","bind","bindActionCreators","willDestroy"],"mappings":"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"}