{"version":3,"file":"core.js","sources":["../src/core.js"],"sourcesContent":["import { assert } from '@ember/debug';\nimport { computed, getProperties, defineProperty } from '@ember/object';\nimport { bindActionCreators } from 'redux';\n\n/**\n  Returns a list of keys that have different values between the two objects.\n\n  @method changedKeys\n  @return {Array} keys that have changed\n  @private\n  */\nfunction changedKeys(props, newProps) {\n  return Object.keys(props).filter(key => {\n    return props[key] !== newProps[key];\n  });\n}\n\n/**\n  Creates a read-only computed property for accessing redux state.\n\n  @method computedReduxProperty\n  @return {Function} an Ember computed property\n  @private\n  */\nfunction computedReduxProperty(key, getProps) {\n  return computed({\n    get: () => getProps()[key],\n    set: () => { assert(`Cannot set redux property \"${key}\". Try dispatching a redux action instead.`); }\n  });\n}\n\n/**\n  Return an object of attrs passed to this Component.\n\n  `Component.attrs` is an object that can look like this:\n\n    {\n      myAttr: {\n        value: 'myValue'\n      }\n    }\n\n  Ember provides that a `get` will return the value:\n\n    this.get('myAttr') === 'myValue'\n\n  @method getAttrs\n  @private\n  */\nfunction getAttrs(context) {\n  const keys = Object.keys(context.attrs || {});\n  return getProperties(context, keys);\n}\n\n/**\n  Return a wrapped stateToComputed function that can be used\n  regardless of whether the input function is a static selector\n  or a factory.\n\n  @method wrapStateToComputed\n  @private\n  */\nfunction wrapStateToComputed(stateToComputed) {\n  return function(...args) {\n    const result = stateToComputed.call(this, ...args);\n    if (typeof result === 'function') {\n      stateToComputed = result;\n      return stateToComputed.call(this, ...args);\n    }\n    return result;\n  };\n}\n\nexport function core(stateToComputed, dispatchToActions) {\n  const redux = this.get('redux');\n\n  if (stateToComputed) {\n    const wrappedStateToComputed = wrapStateToComputed(stateToComputed);\n    const getProps = () => wrappedStateToComputed.call(this, redux.getState(), getAttrs(this));\n\n    let props = getProps();\n\n    Object.keys(props).forEach(key => {\n      defineProperty(this, key, computedReduxProperty(key, () => props))\n    });\n\n    this._handleChange = () => {\n      const newProps = getProps();\n      if (props === newProps) return;\n\n      const notifyProperties = changedKeys(props, newProps);\n\n      props = newProps;\n\n      if (notifyProperties.length > 0) {\n        notifyProperties.forEach((name) => this.notifyPropertyChange(name));\n      }\n    };\n\n    this.unsubscribe = redux.subscribe(() => {\n      this._handleChange();\n    });\n  }\n\n  if (typeof dispatchToActions === 'function') {\n    this.actions = Object.assign({},\n      this.actions, dispatchToActions.call(this, redux.dispatch.bind(redux))\n    );\n  }\n\n  if (typeof dispatchToActions === 'object') {\n    this.actions = Object.assign({},\n      this.actions, bindActionCreators(dispatchToActions, redux.dispatch.bind(redux)));\n  }\n}\n\nexport function update() {\n  if (this._handleChange) {\n    this._handleChange();\n  }\n}\n\nexport function destroy() {\n  if (this.unsubscribe) {\n    this.unsubscribe();\n    this.unsubscribe = null;\n  }\n}\n"],"names":["changedKeys","props","newProps","Object","keys","filter","key","computedReduxProperty","getProps","computed","get","set","assert","getAttrs","context","attrs","getProperties","wrapStateToComputed","stateToComputed","args","result","call","core","dispatchToActions","redux","wrappedStateToComputed","getState","forEach","defineProperty","_handleChange","notifyProperties","length","name","notifyPropertyChange","unsubscribe","subscribe","actions","assign","dispatch","bind","bindActionCreators","update","destroy"],"mappings":"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"}